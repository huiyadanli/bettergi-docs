---
title: 地图追踪
order: 20
---

::: warning 注意


### 请先阅读“调度器”相关说明！

只支持最大的地表地图，不支持地底/分层地图识别，0.45版本后支持渊下宫、层岩巨渊地图。

在特征不明显的地区表现很差，无法正确识别出位置，比如沙漠、风起地等。

地图追踪支持大于等于 `1920x1080` 的 `16:9` 分辨率，太小的分辨率无法识别清小地图。

原神设置中的“小地图锁定”，必须是“锁定方向”。

**地图追踪在截图方式 `WindowsGraphicsCapture` 下表现很差，请使用 `BitBlt` ！**

:::

地图追踪功能基于小地图识别实现。它能自动传送到最近锚点并根据小地图寻路，自动完成采集、战斗等任务。



## 1. 开始运行
### 1.1 通过调度器执行（推荐）
点击 `全自动` - `调度器` ，在该界面创建新的配置组。在弹出的窗口输入配置组名称，点击确认。

![调度器-5如何添加配置组](https://github.com/user-attachments/assets/876282cf-716a-4898-b82d-ab860ebd08dd)


创建好配置组之后，依次选择`配置组名称` - `添加` - `地图追踪任务`。

![调度器-6添加任务(1)](https://github.com/user-attachments/assets/47e5f080-2769-4198-b912-2a462d30cd22)

可以直接选择订阅的全部脚本加入配置组，也可以选择部分脚本加入配置组。选择需要的脚本之后点击 `确定`。

![添加任务](https://github.com/user-attachments/assets/29b6bd7e-ad1f-4504-8092-f2fc48c1a30b)

此时点击运行，将回到原神界面开始地图追踪任务。

![image](https://github.com/user-attachments/assets/b5e5ee0a-0c6c-4eb9-9e5c-a1888b8627ae)

任务进行过程中避免操作鼠标键盘，防止影响脚本的正常运行。
### 1.2 直接执行
点击`地图追踪`，选择特定的脚本，右键选择 `执行任务`，可以执行单独的脚本任务。

![image](https://github.com/user-attachments/assets/26402a58-b814-498b-b3e0-59723982cdfe)

## 2. 脚本配置
分为`地图追踪设置`和`配置组设置`，前者作用于所有脚本，后者作用于单独脚本。`配置组设置`优先级高于`地图追踪设置`。需要单独设置的脚本建议在配置组中设置。

`地图追踪` - `设置` 即地图追踪设置

![脚本配置-1设置路径](https://github.com/user-attachments/assets/ef838847-df46-4a1c-92a1-a0012d128349)

`调度器` - `配置组` - `设置` 即配置器设置

![配置组设置路径](https://github.com/user-attachments/assets/be418697-b438-41c9-8f7a-2f5808002b3c)

### 2.1设置队伍切换

点击`地图追踪` - `设置`，打开设置器。根据`采集物/动作`分类在`包含`后加入所需要的采集物，然后输入所需切换的配队即可

![脚本配置-2地图追踪整体](https://github.com/user-attachments/assets/47450004-fe28-4e60-9549-d3916bd29717)

### 注：设置器内队伍名称必须和游戏内的队伍名称保持一致，仅限中文！
![](https://img.alicdn.com/imgextra/i2/2042484851/O1CN01I1vTaA1lhoJzH9Cqf_!!2042484851.png)

### 2.1设置队伍切换

点击`地图追踪` - `设置`，打开设置器。根据`采集物/动作`分类在`包含`后加入所需要的采集物，然后输入所需切换的配队即可


 也可以在`调度器` - `配置组` - `设置` 中单独进行配置。
 如果当前所处的位置无法切换队伍，则会自动传送至七天神像进行切换。
 
 ![配置组换队](https://github.com/user-attachments/assets/7e69de2c-3423-43b5-97ea-4785310af14c)
 
### 2.2配置行走/生存位
行走位：主要行走（跑图）角色
生存位：开盾/治疗角色，在行走间隔循环释放元素战技（非行走状态不会切换）

**部分情况下，设置特定生存位会导致无法采集或者战斗，请结合实际情况配置生存位。**

与队伍切换设置同理，在`包含`后加入所需角色，即可设置。
**注：设置器内队伍名称必须和游戏内的队伍名称保持一致，仅限中文！**
如果当前所处的位置无法切换队伍，则会自动传送至七天神像进行切换。

 也可以在`调度器` - `配置组` - `设置` 中单独进行配置。
### 2.2配置行走/生存位
行走位：主要行走（跑图）角色
生存位：开盾/治疗角色，在行走间隔循环释放元素战技（非行走状态不会切换）

**部分情况下，设置特定生存位会导致无法采集或者战斗，请结合实际情况配置生存位。**

与队伍切换设置同理，在`包含`后加入所需角色，即可设置。
![](https://img.alicdn.com/imgextra/i1/2042484851/O1CN01s8fjNc1lhoK0y34fD_!!2042484851.png)

建议在`调度器` - `配置组` - `设置` 中单独进行配置

**可以通过调整体型、武器、天赋、双风共鸣以增加移速，但不建议盲目提高移速，可能会导致角色偏离路线。**

部分生存位角色推荐：

* 护盾：莱依拉、绮良良、钟离（钟离默认回头插柱子，如果存在回头路线，可能会爬柱子）
* 前台持续回血：芭芭拉（满命复活）、七七
* 后台回血：生命值低于 40% 时，**迪希雅** 将基于生命值上限的 20% 恢复生命值，并在接下来的 10 秒内，每 2 秒基于生命值上限的 6% 为迪希雅恢复生命值。该效果每 20 秒至多触发一次。
* 采集回血：**白术** 处于队伍中时，与部分采集物交互能够为队伍中自己的当前场上角色恢复生命值，回复量基于白术生命值上限的 2.5%。

注意：当前版本当队伍中存在 **白术** 、**希格雯**、**珊瑚宫心海** 三个角色时，会在前台角色低血量时自动回血。

### 2.3 配置回血和小道具
- `BetterGI` 默认在发现前台角色血量不足或者弹出复活界面时前往七天神像回血，开启 `只在传送点回复` 时，可以确保即使前台角色血量过低，也会优先完成采集任务而不是回血之后再重试路线。检测到复活界面时，无条件回血复活，无法自定义。
- 配置 `使用小道具间隔` 时，会以一定周期自动按下使用小道具按钮，可以使用 `食物袋` 周期性给前台角色回血，也可以使用 `王树瑞佑` 砍伐树木，其他更多功能自行发掘。
地图追踪设置

![脚本配置-3额外设置](https://github.com/user-attachments/assets/0bfa07f8-b086-449b-8964-d347494fbe9a)

配置组设置

（图示）

### 2.4 战斗配置
在运行涉及战斗相关的脚本时，**必须**在 `独立任务` - `自动战斗` 或者  `调度器` - `配置组` - `设置` - `战斗配置` 中配置战斗策略和相关参数，相关参数在软件内有详细说明。

`自动检测战斗结束` 功能基于战斗时无法打开队伍配置界面实现，因此对于部分无仇恨怪可以考虑关闭该功能使用战斗超时控制战斗的时间。该功能默认开启，当系统检测到战斗结束后，会立即停止自动战斗。系统默认会在每轮战斗循环结束后自动执行一次检测。单次检测的时间间隔= `检查战斗结束的延时`+`按键触发后检查延时`。除了单次战斗循环结束后检测之外，如果开启了 `更快检查战斗结束`，可以通过定时检测和角色触发检测两种方式触发，通过以下方式进行设置：

1. 定时检测模式
- 设置格式：输入数字(单位:秒)
- 示例:输入`5;`表示每 5 秒自动检测一次战斗状态
- 关闭定时检测：数字≤0 (如 `0` 或 `-1`)
- 关闭定时检测：数字≤0 (如 `0` 或 `-1`)
2. 角色触发检测模式
- 设置格式: 输入角色名称
- 示例：输入 `白术;`, `钟离;` 表示当这些角色完成当前行动后，立即触发状态检测
- 多个角色请用分号分隔，角色名称请使用游戏内官方名称。
以上两种检测模式也可以组合使用。组合使用示例：`5;白术;钟离;`表示同时启用:
- √ 每 5 秒定时检测
- √ 白术行动后立即检测
- √ 钟离行动后立即检测

参数分隔请使用英文分号";"。

**对于部分无仇恨怪可以考虑使用战斗超时控制战斗的时间**
请自行权衡是否要开启 `更快检查战斗结束`，开启 `更快检查战斗结束` 可大幅提升战斗结束的识别速度，但频繁检测可能会导致队伍罚站而战斗失败。

![image](https://github.com/user-attachments/assets/73841e73-99f4-4b6c-b6c7-4621ffb93d9d)

已知问题：因为 `自动检测战斗结束` 基于战斗时无法打开队伍配置界面实现，因此当角色在战斗过程中落水，可能导致检测失败。

## 3. 常见问题

### ❓我在XXX点位卡住了。
在某个点位卡住通常原因是识别精度问题所引起的角色位置偏差，也有可能是你的角色身高问题，请联系路径作者核对地图点位是否需要优化，也可查看[Javascript 脚本-常见问题](/feats/autos/jsscript.html#常见问题)中提供的解决方案。

### ❓能不能在外部看到自己的地图识别情况？
执行前点击 `查看实时追踪地图`，可以看到实时的地图识别情况。此功能只建议在窗口化的情况下移动到原神窗口之外使用，以避免鼠标模拟误触窗口导致脚本运行失败。

### ❓如何使用他人分享的脚本文件？
使用其他人分享的脚本文件时，将脚本文件放在 `\User\AutoPathing` 目录下，即可通过添加 `调度器` 执行或者直接执行。

### ❓为什么我的角色老是转圈圈？
  以下三种原因之一：
- 原神 `设置`-`小地图锁定` 不是 `锁定方向`
- 使用了非 `BitBlt` 截图方式 (0.44 版本修复)
- 使用 `CPU` 性能过差

### ❓有没有不用纳西妲的脚本？我没有纳西妲。
脚本仓库是 `BetterGI` 提供的脚本平台，里面的脚本即是目前的全部脚本。欢迎自行录制相关脚本并上传到`脚本仓库`。

### ❓为什么我的钟离不开盾/为什么不挖矿
请根据脚本的要求更换其他生存位或使用脚本要求的角色。

### ❓这个晶蝶怎么老是抓不到啊，太呆了。
请携带 `早柚` 或者 `瑶瑶`。晶蝶位置不固定，而地图追踪也是基于小地图识别的回放功能，如果晶蝶抓不到可以考虑多次运行脚本。

### ❓我想暂停一下脚本捡个材料，怎么暂停啊，停止脚本就没办法接着跑了？
`快捷键` - `暂停当前脚本/独立任务` 绑定快捷键。请不要绑定游戏中常用的按键。暂停之后再次点击绑定的快捷键可以恢复。当前版本如果在行走的时候暂停脚本，可以传送去别的地方，距离过远会自动重试路线，也能成功恢复运行脚本。如果是暂停后继续运行时在原点位附近，恢复时无法恢复 W 的按下状态，为已知问题。

![6aba1a27981322b1bee25a41dc6b0558](https://github.com/user-attachments/assets/2b747949-1e74-41d7-91a3-f4c77c4ed7c5)

### ❓我把群文件的脚本仓库文件按要求放到\User\AutoPathing里面去了，怎么用不了？
[见 1.1通过调度器运行](#11-通过调度器执行推荐)

### ❓为什么我运行任务自动取消了？
`快捷键` - `取消当前脚本/独立任务` 绑定了原神常用按键，如 F1-F7，W、A、S、D、F、L、M、Z、X 等。请改为其他按键。

### ❓我运行的地图追踪所需版本号比当前最新 BetterGI 的版本号还要新。
在版本更新的几天会有部分路径的版本要求领先当前的正式版，那是作者在 BetterGI 测试版本提供的功能提前制作的，可以尝试更新为最新的测试版，否则就需要等待正式版更新（特别注意：自己去json文件中修改版本号要求是错误操作）。

### ❓为什么自动挖矿不用钟离？
钟离的持有率不能算100%，一定是低于女仆的。钟离长e后矿物可能会出现崩飞的情况，提高漏捡率，而大剑角色的A跳可以贴住矿物，一打掉就进行拾取。

## 附录
- ✨ 地图追踪的核心功能参考自 [minimap](https://github.com/tignioj/minimap)
项目，[minimap](https://github.com/tignioj/minimap) 是一个完成度非常高原神自动采集工具，当然它的功能远不止这些，强烈推荐！

## 制作你的地图追踪脚本

想自己录制并制作地图追踪脚本？请参考开发者文档：

- [地图追踪任务制作（开发者）](/dev/pathing-dev.html)
