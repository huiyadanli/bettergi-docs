---
title: 路径追踪控制文件
order: 22
---

# 路径追踪控制文件

## 功能概述

通过在追踪文件目录中放入`control.json5` 配置文件，实现对同目录下其他 JSON 文件的配置操作(运行时），特别针对一个系列的可以不修改实际文件情况下，实现配置修改。也可以通过 调度器》更多功能》导出根据控制文件修改内容，来批量修改路径追踪文件，主要提供两种合并模式：

1. **属性覆盖（Cover）** - 递归合并对象，保留目标 JSON 中未被覆盖的属性
2. **对象覆盖（Obj Cover）** - 整体替换目标属性，不保留原有内容


---

## control.json5 API 参考

### 文件结构

```json5
{
  // 全局属性覆盖规则
  "global_cover": { /* 对象结构 */ },
  
  // 全局对象覆盖规则
  "obj_global_cover": { /* 对象结构 */ },
  
  // 特定路径配置规则
  "json_list": [
    {
      "name": "目标路径名称",
      "cover": { /* 属性覆盖规则 */ },
      "obj_cover": { /* 对象覆盖规则 */ }
    }
  ]
}
```

### 字段详解

#### 1. global_cover
- **类型**: `Object`
- **必需**: 否
- **描述**: 应用于所有目标 JSON 的属性覆盖规则
- **行为**: 递归合并对象属性
- **示例**:
  ```json5
  "global_cover": {
    "info": {
      "bgi_version": "0.44.0", // 更新版本号
      "author": "System Admin" // 修改作者
    }
  }
  ```

#### 2. obj_global_cover
- **类型**: `Object`
- **必需**: 否
- **描述**: 应用于所有目标 JSON 的对象覆盖规则
- **行为**: 完全替换目标属性
- **示例**:
  ```json5
  "obj_global_cover": {
    "global_params": { // 添加全局参数组
      "render_mode": "raytracing",
      "texture_quality": "high"
    }
  }
  ```

#### 3. json_list
- **类型**: `Array<Object>`
- **必需**: 否
- **描述**: 针对特定路径的配置规则列表

##### 列表项属性
| 属性名    | 类型     | 必需 | 描述             |
|-----------|----------|------|----------------|
| `name`    | `String` | 是   | 匹配文件名（不需要加扩展名） |
| `cover`   | `Object` | 否   | 属性覆盖规则         |
| `obj_cover` | `Object` | 否   | 对象覆盖规则         |

**示例配置**:
```json5
"json_list": [
  {
    "name": "6101--纳塔_镜璧山_西海岸1_(8-13)",
    "cover": {
      "info": {
        "type": "collect_v2" // 更新类型
      }
    },
    "obj_cover": {
      "positions": [ // 完全替换位置数据
        {"id": 100, "x": 10000, "y": -1500},
        {"id": 101, "x": 10200, "y": -1600}
      ]
    }
  },
  {
    "name": "7202--璃月_青墟浦_东海岸_(12-18)",
    "cover": {
      "myconfig": {
        "tags": "dusk" // 可以增加自定义配置，一般用于js中来控制实现扩展功能
      }
    }
  }
]
```

---

## 合并规则执行顺序

1. **应用全局属性覆盖**  
   `global_cover` → 递归更新所有目标 JSON 的匹配属性

2. **应用全局对象覆盖**  
   `obj_global_cover` → 完全替换/添加全局对象

3. **匹配特定路径规则**  
   遍历 `json_list`，找到第一个 `name` 匹配目标 JSON `info.name` 的规则：
   - 应用 `cover` 属性覆盖
   - 应用 `obj_cover` 对象覆盖

> 匹配优先级：特定规则 > 全局规则 > 原始值

---

## 典型使用场景

### 场景1：批量更新版本号
```json5
// control.json5
{
  "global_cover": {
    "info": {
      "bgi_version": "0.45.0"
    }
  }
}
```

### 场景2：修复特定路径数据
```json5
// control.json5
{
  "json_list": [
    {
      "name": "6101--纳塔_镜璧山_西海岸1_(8-13)",
      "obj_cover": {
        "positions": [
          {"id": 1, "x": 9989.59, "y": -1607.81} // 修复坐标
        ]
      }
    }
  ]
}
```

### 场景3：增加自定参数
```json5
// control.json5
{
  "obj_global_cover": {
    "render_settings": {
      "ray_bounces": 8,
      "shadow_quality": "ultra",
      "reflection": true
    }
  }
}
```

---

## 使用方式

1. **配置后直接运行**  
   在目标目录创建 `control.json5`，编写合并规则，然后调度器里面直接运行。
2. **批量导出合并过后的文件**  
   在目标目录创建 `control.json5`，然后调度器》更多功能》导出根据控制文件修改内容。可以导出实际运行时的文件，来达到批量修改的目的。



---

## 注意事项

1. **名称匹配**：
   - 不支持子目录中的文件覆盖，只能针对控制文件当前目录的文件修改
   - 名称匹配区分大小写和空格

2. **合并规则**：
   - 数组被视为基础类型，直接替换
   - 嵌套对象会递归合并
   - 对象覆盖优先级最高
